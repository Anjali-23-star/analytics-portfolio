## Revenue generated by Top 20% customers.

WITH raw_data AS ( SELECT customerID as customers,
											quantity*unitPrice as amount 
							  FROM online_retail ), 
customer_data AS ( SELECT customers,
											SUM(amount) as revenue_per_customer 
								FROM raw_data GROUP BY customers), 
customer_revenue AS ( SELECT customers,
												revenue_per_customer, 
                        ROW_NUMBER() OVER(ORDER BY revenue_per_customer DESC) AS rn,
                        COUNT(*) OVER() AS total_customers, 
                        SUM(revenue_per_customer) OVER() AS total_revenue 
									FROM customer_data) 
SELECT customers, 
			 revenue_per_customer, 
       rn,
       (revenue_per_customer*100)/total_revenue AS revenue_percentage 
FROM customer_revenue
WHERE rn <= total_customers*0.2; 
